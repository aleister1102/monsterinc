# Product Requirements Document: Discord Notifications

## 1. Introduction/Overview

This document outlines the requirements for the Discord Notifications feature within Project MonsterInc. The purpose of this feature is to provide users with timely updates and alerts regarding scanning processes and critical findings directly via Discord webhooks. This will enable teams to stay informed about the security posture of their targets and react promptly to potential issues.

The goal is to integrate Discord as a notification channel for scan summaries and critical error alerts generated by the tool.

## 2. Goals

*   Provide users with automated notifications about completed scans for each target.
*   Alert users to critical errors encountered during the scanning process.
*   Ensure notifications are informative, well-formatted, and actionable.
*   Allow for robust error handling in case of Discord webhook unavailability.
*   Manage message length effectively when dealing with a large number of targets.

## 3. User Stories

*   **As a DevSecOps Engineer, I want to receive a Discord notification summarizing the scan results (total URLs, new URLs, report link) for each target upon completion, so that I can quickly assess the scan's outcome.**
*   **As a Security Analyst, I want to be immediately notified via Discord with a trace log when a critical error occurs during a scan, so that I can investigate and troubleshoot the issue promptly.**
*   **As an Administrator, I want the system to log an error if the configured Discord webhook is unavailable, so that I can be aware of notification delivery failures.**

## 4. Functional Requirements

1.  The system **must** allow users to configure a Discord webhook URL.
2.  The system **must** send a notification to the configured Discord webhook when a scan for a target is completed.
3.  The "scan completed" notification **must** include:
    *   Target identifier (e.g., URL or name).
    *   Total number of URLs found for the target.
    *   Total number of *new* URLs found for the target (compared to a previous scan, if applicable).
    *   A direct link to download the full HTML report for that target's scan.
4.  The system **must** send a notification to the configured Discord webhook if a critical error occurs during the scanning process.
5.  The "critical error" notification **must** include:
    *   An indicator of the error.
    *   The trace log or relevant error details.
6.  Notifications **must** be formatted using Discord markdown for readability.
7.  Notifications **should** use emojis to enhance visual appeal and convey status (e.g., :white_check_mark: for success, :x: for error).
8.  Notifications **should** aim for an aesthetically pleasing and clear presentation.
9.  If a scan involves a large number of targets such that a single Discord message would be too long or exceed Discord's character limits, the system **must** split the information across multiple appropriately sized messages.
10. If the Discord webhook is unavailable or returns an error during a notification attempt, the system **must** log this failure event (e.g., to the standard logging framework). It should not halt the primary scanning process.
11. The content of the Discord notification (e.g. which fields to include in the summary) **should** be configurable, if feasible within the project scope.

## 5. Non-Goals (Out of Scope)

*   Interactive elements within Discord notifications (e.g., buttons to trigger actions). Notifications are informational.
*   Storing history of sent Discord notifications within this specific module (logging of send attempts is sufficient).
*   Real-time, incremental updates *during* a scan via Discord. Notifications are primarily for scan completion or critical errors.
*   User-specific notification preferences (e.g., different users receiving different types of alerts). A single webhook configuration is assumed initially.

## 6. Design Considerations (Optional)

*   Discord messages should utilize markdown effectively (bolding, bullet points, code blocks for trace logs).
*   Consider using Discord embeds for a richer presentation of information.
    *   Example structure for a "scan completed" embed:
        *   **Title:** Scan Completed: `[Target Name]`
        *   **Color:** Green (success)
        *   **Fields:**
            *   Total URLs: `[Number]`
            *   New URLs: `[Number]`
            *   Report: `[Link to HTML Report]`
    *   Example structure for a "critical error" embed:
        *   **Title:** :x: Critical Scan Error!
        *   **Color:** Red (error)
        *   **Description:** An error occurred while scanning `[Target Name/Process]`.
        *   **Fields:**
            *   Trace Log:
                ```
                [Trace log details]
                ```
*   Ensure that links to reports are fully qualified and accessible.

## 7. Technical Considerations (Optional)

*   The Discord notification mechanism should be implemented as a modular component.
*   Use a resilient HTTP client for sending requests to the Discord webhook, with appropriate timeouts and retry mechanisms (though retries for notifications might be overkill if logging the failure is sufficient).
*   Be mindful of Discord API rate limits if sending many messages in rapid succession (relevant for the "many targets" scenario). Implement delays if necessary.

## 8. Success Metrics

*   Successful delivery of notifications to the configured Discord webhook (measurable via logs or by observing Discord channel).
*   User feedback indicating the notifications are timely, informative, and helpful.
*   Reduction in time taken for users to become aware of scan completions or critical issues.

## 9. Open Questions

*   Should there be a global on/off switch for all Discord notifications?
*   What are the specific character limits for Discord messages/embeds to consider when splitting notifications for many targets?
*   Is there a preference for how "new URLs" are determined if a baseline doesn't exist (e.g., first scan)? Treat all as new?
*   Should the notification indicate which httpx configuration parameters (threads, delay, user-agent, excluded extensions) were used for the scan that triggered the notification? (Based on user feedback, this seems to be general tool configuration, not directly tied to the notification content itself, but worth confirming if a summary is desired). 